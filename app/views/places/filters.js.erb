$("#resultsSliderContainer").html("<%= escape_javascript(render partial: 'results', locals: { places: @filtered_places}) %>");

$(document).ready(function() {
  console.log('Initializaing map recenter on marker click')
  function newLocation(newLat,newLng) {
    map.setCenter({
      lat : newLat,
      lng : newLng
    });
    map.setZoom(12);
  };

  var lat;
  var lng;

  $('.wall-image-container').on('click', function() {
    var imageContainer = $(this).attr('data-place-id')
    var imageId = $(this).children().attr('data-image-id')
    if (imageContainer == imageId) {
      var pictureHighlight = $('.picture-highlight[data-highlight-id="' + imageId + '" ]')
      pictureHighlight.fadeIn(300);
      $('#navmap, .picture-highlight').on('click', function() {
        pictureHighlight.fadeOut(300)
      })
      $('.highlight-close').on('click', function (){
        pictureHighlight.fade(300)
      })
    }
  });

  $('.places').on('click', function() {

    // recenter map on place click
    var lat = parseFloat($(this).attr('data-latitude'))
    var lng = parseFloat($(this).attr('data-longitude'))
    newLocation(lat, lng);

    // open IW on place click
    var place_id = $(this).attr('data-id');
    var markersData = gon.markers;

    // same logic as in map.html.erb
    // TODO: extract and combine
    openInfoWindow = [];

    function closeInfoWindow() {
      $( '.filter-button' ).click(function() {
        for (var i=0; i < openInfoWindow.length;i++) {
          openInfoWindow[i].close();
        }
      });
    }

    // match GMAP marker with place clicked id
    function findMarker(markersData) {
      return markersData.find(m => m.id === place_id);
    }

    function openInfowWindow() {
      var matchedMarker, latlng, markerInfowindow;

      matchedMarker    = findMarker(markersData);
      latlng           = new google.maps.LatLng(matchedMarker.place_lat, matchedMarker.place_lng);
      markerInfowindow = matchedMarker.infowindow

      var marker = new google.maps.Marker({
        map: map,
        position: latlng,
        icon: icon
      });

      var iwContent = markerInfowindow;

      infoWindow = new SnazzyInfoWindow({
        marker: marker,
        content: iwContent,
        closeWhenOthersOpen: true
      });
      infoWindow.open();

      openInfoWindow.push(infoWindow);
      closeInfoWindow();
    }

    var icon = {
      path: "M4.415,8.829c2.432,0,4.415-1.983,4.415-4.415 C8.829,1.983,6.846,0,4.415,0S0,1.983,0,4.415C0,6.846,1.983,8.829,4.415,8.829z",
      fillColor: '#fff',
      fillOpacity: 1,
      anchor: new google.maps.Point(0,0),
      strokeWeight: 0,
      scale: 0
    }

    openInfowWindow();
  })
});
