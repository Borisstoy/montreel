$("#filter-results").html("<%= escape_javascript(render partial: 'kind', locals: { places: @places_by_kind } ) %>");

$(document).ready(function() {
  console.log('Initializaing map recenter on place click')
  function newLocation(newLat,newLng) {
    map.setCenter({
      lat : newLat,
      lng : newLng
    });
    map.setZoom(15);
  }

  var lat;
  var lng;

  $('.places').on('click', function() {
    // recenter map on place click
    var lat = parseFloat($(this).attr('data-latitude'))
    var lng = parseFloat($(this).attr('data-longitude'))
    newLocation(lat, lng);

    // open IW on place click
    var place_id = $(this).attr('data-id');
    var markersData = gon.markers;

    // match GMAP marker with place clicked id
    function findMarker(markersData) {
      return markersData.find(m => m.id === place_id);
    }

    function openInfowWindow() {
      var matchedMarker, latlng, markerInfowindow;

      matchedMarker    = findMarker(markersData);
      latlng           = new google.maps.LatLng(matchedMarker.place_lat, matchedMarker.place_lng);
      markerInfowindow = matchedMarker.infowindow

      var marker = new google.maps.Marker({
        map: map,
        position: latlng,
        icon: icon
      });

      var iwContent = markerInfowindow;

      infoWindow = new SnazzyInfoWindow({
        marker: marker,
        content: iwContent,
        closeWhenOthersOpen: true
      });
      infoWindow.open();
    }

    var icon = {
      path: "M4.415,8.829c2.432,0,4.415-1.983,4.415-4.415 C8.829,1.983,6.846,0,4.415,0S0,1.983,0,4.415C0,6.846,1.983,8.829,4.415,8.829z",
      fillColor: '#fff',
      fillOpacity: 1,
      anchor: new google.maps.Point(0,0),
      strokeWeight: 0,
      scale: 2
    }

    openInfowWindow();

  })
});
